
Faire détection plus robuste en regardant plusieurs images et selon un detectionrate sur une durée quitte à augmenter un peu FPS

UxVCtrl github w700 problem

linefollowingrelativerobot relatif au cap
rajouter commande setwindestimation/wgs avec unités des marins

Faire programme pour aider à la mag calib
Appli gps qui affiche sog à partir des logs?
Dashboard : pouvoir n'afficher qu'une certaine partie de la traj, manque fmod360 pour sailangle, évaluer aussi COG, texte devrait s'afficher au-dessus des dessins, rajouter les mêmes types d'infos que dans UxVCtrl (GUI et showdetailedinfo) et voir aussi avec UxVDataViewer
mettre dashboard sur github?

Afficher tension, direction vent, affichage des infos du waypoint courant mission planner
modify waypoints/heading commands so that they do a line following in the case of a sailboat?
Copier implémentation launchtcpsrv pour la modifier et stopper correctement

Some threads may be too fast, check timings...
add a visual studio config for Linux, utiliser dernière version linux headers?

bugs
should add commands critical section so that bWaiting = FALSE would never risk to be overwritten just after...
Quand problème caméra (rpi2 avec cv310), tous les autres device reconnectent en boucle?->pas vu ce type de problème sous Windows ni rpiz cv2.4…
Invalid minangle, midangle or maxangle sometimes on rpi2?
Si le pipe est au centre de l'image mais tout en bas, le tracking marchera pas bien...
Pour les commandes sans paramètres, si des caractères erronés sont après la commande mais avant le retour à la ligne, ça marche quand même, est-ce qu'il faut retourner erreur?->rajouter \n dans l'analyse de toutes les commandes?->ne marche pas sous Linux...
bug bVideorecording à 0 après stop mission qui enregistrait (regarder quand on appuie sur r après le stopmission)? bVideoRecording and bVideoRecordRequests...
crash du programme lorsqu'on appuie sur p pour stopper mission : video recording pas stoppé correctement (deletetimer doit pas être appelé si on a encore un timercallback en cours?)...? ou alors il ne faut pas arrêter en même temps les 2 vidéos... mais je les arrête pas...
why I need to press twice r to stop videorecording when it was started by a script?->c'est logique, il faudrait sans doute que la variable locale bVideoRecording soit réglée en fonction de videorecordrequests, peut-être la supprimer dans OpenCVGUI et rendre l'enregistrement indépendant du fait que la GUI soit enabled ou pas, les videorecordrequests étant juste soit 0, soit 1, seul l'appui de la touche r ou les command start/stop videorecording doivent controler l'enregistrement...
protéger par OpenCVCS les VideoWriter?
tester mission crash vidéo sur sardine pendant longtemps, sur des missions, en appuyant sur tous les boutons...
Quand je fais un lock des statevariables pour staticlocalization, vérifier que si le lock dure pas trop longtemps ça fait pas timeout et reconnexion des capteurs
race condition : vérifier que si 2 entercritical section différents se suivent, c'est toujours dans le même ordre quel que soit le thread...
pb opencv 2.4.9 qt gentoo linux touches maj et avec plusieurs fenêtres opencv dans threads->à cause de Qt?
GTK : now the keys are randomly received by the 2 windows...
préparer qt .pro pour débugguer
bug seanet et peut-être d'autres : en sortie de la boucle de thread principal il y a des free qui ne devraient être faits que si bConnected, fuite mémoire aussi...?->en fait ça va pas bugger, mais c'est un peu limite...
déco temp mti-g sardine->probably internal mti-g bug, its position estimation and packet counter seem to reset... ou alors le fait que j'ai changé la période du thread?
surface intempestif pendant sonar map->bug dans mission, rajouter sleep entre headingreg et depthreg? comme si depthreg -2 pas pris en compte et régulation profondeur désactivée?->problème un peu comme avec le voilier qui validait pas waypoints et continuait régulé, deadlock...?

logs
vxy->vrx, theta->psi (attention au psi du vent et autres éventuels phi à remplacer avant...), omega->psidot
dans logstate et logsimu, remplacer t par valeur decimale depuis l'Epoch et rajouter colonne t_app à la fin qui correspond à ce qu'il y a actuellement...?
logstate était compatible avec le début de logsimu à l'origine...->rajouter dans logsimu les t;lat;lon;alt;hdg;... aussi
avec nouveau format, lognav2KML va être simplifié

sonar, localisation, wf
voir comment j'ai rajouté state equations 2.5D dans UxVDataViewer
commencer à prévoir dl en utilisant staticloc avec la position des pings dessinée avec le dr, pour l'instant il faudrait juste appeler dl toutes les 10s par exemple et le seul avantage par rapport à static serait de ne pas devoir arrêter le robot...
Contract a besoin de section critique pour dhat... isoler en une fonction qui utilise pas les variables globales mais prend tout le nécessaire en paramètres, bien voir ce qui en entrée et en sortie, et l'isoler dans un thread séparé, faire un peu pareil pour la partie affichage...
simu qui produit scanlines (en reconstituant une scanline à partir de la distance qu'il retourne, on risque d'en avoir besoin si on veut attribuer des scores), wf complète puis passe par SeanetProcessing?
c'est juste au niveau de l'affichage qu'on dessinera pareil...?
Où mettre la partie dessin des images sonar en overlay, c'est commun en partie avec seanet et simulator... dans SeanetProcessing?
statevars va être très ralenti à cause de dmes..., faire une cs spécifique?
mindist, maxDist, threshold params... maintenant c'est peut-être plus sur adspan, adlow, gain qu'il faut jouer...
0.1*omegas...
options pour enlever les outliers avant, après...
repère dans lequel dessiner image sonar vs detection d'obstacles
pendant une static localization, tout est bloqué à cause des sections critiques, il ne faut pas qu'il y ait une régulation en cap activé à ce moment!!!
Utilisation de headingreg et depthreg pendant staticloc?
seanet : index_scanlines est peut-être moyennement géré si sector scan...
données aberrantes vxyhat dans logstate?
simu : au début convergence vers un intervalle tout petit correspondant au biais quand y a GPS, convergence vers un intervalle de vitesse tout petit...
vhat->vxhat, vhat=Cabs(Sqrt(Sqr(vxhat)+..., vhat=Cequal(sog) if gps...
hokuyo device like sonar, tool to convert data files to seanet, should make getlatestmessage able to handle all messages types since the device can send messages continuously...
image sonar simu pas bonne?->portée sonar, autres params? Rajouter option pour que l'image soit corrigée en cap ou non...
flux acoustique sur un mur pas tout à fait droit...
LIDAR/sonar : mesurer vitesse si le cap change peu et les obstacles changent peu avec le faisceau avant et arrière

GUI, video
MAVLinkInterface : solve message Failed to update home location...
rajouter fond d'ecran carte google earth (->possible hack with video, but a bit hard to set good coordinates!)
mousecallback to set waypoints, lines...
use cvGetCaptureProperty(capture, CV_CAP_PROP_FPS) when reading video file in Video.cpp, modify also in remotewebcamsrv?
pouvoir avoir un nb de fenêtres indépendant du nb de caméras
prévoir zoom sur la map, on a du mal à savoir son cap
faudrait pouvoir enregistrer en high res en local en option->utiliser remotewebcammultisrv et se connecter dessus...
mieux gérer les infos affichées selon le robot et selon le mode
alterner les valeurs affichées toutes les s?
afficher le commentaire action d'une mission (e.g. en bas...)->déjà affiché dans invite de commandes
pouvoir afficher robot indépendamment de l'échelle, afficher en option l'image sonar corrigée avec la boussole et en option l'estimation de position
mettre aussi BRG de ball par rapport au nord?
FullImg : (webcams|sonarscreenshot|sonarwaterfall)|&(MapOverlay)|&(SonarDistancesOverlay)|&(WallTrackingOverlay)|&(VisualObstacleAvoidanceOverlay)|&(BallTrackingOverlay)|&(PipelineTrackingOverlay)
MiniatureImg : (webcams|sonarscreenshot|sonarwaterfall)|&(MapOverlay)|&(SonarDistancesOverlay)
(walltracking overlay fait aussi walldetect, wallavoidance)
bug enregistrement de la 2ème caméra quand c'est dans le script? -> enregistrer vidéo manuellement ou rajouter un délai...
pouvoir lancer un opencvgui independamment du nombre de cameras, dynamic resolution changes?, voir le sonar comme une caméra?, appuyer sur la touche '0' met caméra '0', '1', caméra 1, '8' sonarscreenshot, '9' sonarwaterfall...
utiliser bCleanup dans tous les threads pour le cvSet()?
opencv cherche toujours à ouvrir la meme cam s'il n'y en a qu'une et qu'on veut en ouvrir une 2ème?
essayer de mettre en commun certaines parties du code de détection d'objet, e.g. savepicfiles() dans globals.h...->pas forcément souhaitable
Mettre en var globale les périphériques?
Pour la taille des images partagées, prendre la résolution min des webcams
Les paramètres globaux videoimgwidth/height n'ont peut-être plus d'utilité
détection quand il y a quelque chose de visible à la caméra pour détecter quand on est près du fond

acousticmodemlocalization
commande comme setstateestimation/gpslocalization qui contracte la position par acoustique
quand il y a incohérence, agrandir et recommencer à contracter 3 fois?
toutes les 5-10 s quand sous-marin envoie ask\n 3 fois (avec au moins 2 cohérentes), surface envoie xyzerr (4 int16) 3 fois et si au moins 2 messages cohérents le sous-marin envoie rng\n puis attend la réponse (3 fois, la réponse semble de la forme \n\rRange=0.9m\n\r) et si au moins 2 distances cohérentes (ici c'est pas bit à bit, ça peut légèrement varier entre 2 rng...), il contracte sa position
->mais c'est pas forcément robuste aux décalages, liés aux bouts de messages fantômes... s'il y en a...
on peut peut-être s'en tirer aussi bien sans le ask\n, à réfléchir...
dans la spec, il faudrait rajouter un message shh\n pour interrompre les sendxy provoqués par un ask\n... est-ce que c'est vraiment utilisable?
cohérence des messages : il faut regarder bit par bit (il faut qu'au moins 2 bits sur 3 soient cohérents à chaque fois)
(modems envoient probablement par paquet de 4 octets (sans doute complété par des octets nuls))
flush du modem quand il reçoit des données invalides?
bug code modem : xhat et yhat ne sont pas agrandis en cas d'ensembles vides après Cdistance(), seul P est agrandi...?
add velocityofsound as env global param as necessary for echo message...
rajouter param acousticmodem_r_max_err dans UxVCtrl.txt et MDM0.txt comme pour sonar...
time-division method
envoyer (périodiquement?) un message sp avec la valeur opi trouvé lat long... en option dans ball et pipe
acoustic localization : stop specifically submarine to be able to communicate correctly (perturbations by thrusters?)?
pour pouvoir analyser toutes les données qui viennent du modem facilement et retirer les vieilles, il vaut mieux utiliser des messages qui ont une en-tête et fin prédéfinie...
faire un recv et analyser un peu le message comme les autres périphériques, regarder aussi ce qu'a fait Clément
To be able to make a real communication protocol, should receinve 4 bytes, check the beginning of the data to determine if it is a known message, receive remaining data  if the specific message needs it, and act accordingly...
vu le temps de transmission de 2 positions valides et d'1 rng, il vaut mieux que l'émetteur soit fixe...
compte tenu du fait que hovercraft est presque fixe et de la vitesse du sous-marin, ça revient à une précision de 10 m
peut-être qu'il vaudrait mieux regrouper les 2 positions dans le même message pour gagner du temps...
disableallcontrols désactive aussi toute commande acoustique... (sans doute parce qu'il peut y avoir des régulations dues à une commande acoustique...)

Missions
mettre logvid2imgoverlay sur github, corriger bug de flip ou autre avec vue rochers sauc-e, update rotation etc. with what is in Video
Mosaiquing video avec les logs de 2014
pour les détections, être plus robuste en regardant plusieurs images de suite : objMinDetectionDuration...
Chercher l'anomalie avec toutes les caméras et sonar avec portée réduite car elle a été bougée pour la finale?
station : rajouter bStationControl comme bBrakeControl, voir paper_vstab_rc.pdf
manque statevariables cs dans MissionLogThread, idem logwall? theta_wall... voir Ball...
pas de setmissionaction init et end : peut-être que j'ai fait un copier coller sans eux? szAction non protégé...
comment attendre la détection de ball OU un message acoustique dans les scripts?
mission par sms : option /s check missions from sms.txt or sms folder...
Pouvoir programmer avec les touches de la télécommande
commande spéciale pour charger et surveiller un fichier Waypoints.csv comme VAIMOS pour pouvoir changer les waypoints uniquement par ftp
ou plutôt voir sms, VAIMOS Iridium... faire fonction CheckMission() qui vérifie si mission.txt a changé?
command watchdog t bExit qui interrompt la mission au bout d'un certain temps et en option quitte le programme (si le programme a été lancé dans un script batch, il peut alors être ensuite lancé avec une autre mission...)
resume file indicating at which line the mission should restart in case the program stopped (as well as an initialization script, or we should design the script so that all the needed initialization steps are correctly specified on the resume line)
setresumepoint : command to indicate a resumepoint (updates the resume file with the current mission line)
sauvegarder e,phi,delta_theta dans wall?

Actuators
revoir mon organisation des pwm pour qu'ils puissent apparaitre sur n'importe quel chan > 5 en m'inspirant de la gestion des analogin de maestro...
MAVLinkDevice : actuellement on ne peut controler que les canaux prévus par le firmware du coup faudrait aussi pouvoir changer la correspondance entre mes canaux et ceux de l'APM? rajouter touches spéciales pour changer mode (manual, stabilize, etc.), touches pour désactiver l'override...
param midangle : changer les formules de conversion entre uw et rudder pour que ça puisse ne pas être symétrique...
reconnection auto de ssc32 a peu de chances de servir car on ne fait qu'envoyer des données...
revoir l'organisation des actionneurs (IM483I, ue9, ciscrea...), configuration de u1,u2 avec canal, pwm us ou ms->voir ssc32
ue9 : rajouter eth, DO, DI, pulseinput, i2c, voir comment faire similaire à SSC-32/IOIOSrv...
trim/offset, min max facilement réglables dans interface, certains paramètres reconfigurables immédiatement, d'autres prennent du temps (offset, gain, portée sonar...?), faire fonctions spécifiques pour qu'on sache lesquels sont facilement modifiables...->maintenant on a les commandes deviceconfig device.txt...
quantification des actionneurs centrée en 0, empêcher aussi de passer d'une valeur extrême à une autre (e.g. gouvernail quand waypoint opposé...), rudderupdate period?
voiliers : pouvoir mettre la voile à autre chose que 0 au démarrage (pas trop important car la télécommande peut faire le nécessaire...)->utiliser InitPW?->mais écrasé par u dans le thread...
vérifier la bonne utilisation d'InitPW...

GPS, NMEA, waypoints, AHRS
SBG
Update also DCB settings Windows, check current settings to know what to set manually, check if equivalent to cfmakeraw()
rajouter utc du GPS (variable globale mis à jour uniquement par NMEA car pour MT et MAVLink on a l'heure PC dans leurs logs) pour trouver erreur d'horloge?
enregistrer cog sog dans un des logs (logstate)?
mtdata2 : faire findlatestmsgwithoutmid...? Coordinate system not the same between legacy and normal modes!
mti-g : gps pris en compte si utctime valid, il faudrait peut-être plutôt regarder status? UTCValid semble le plus strict donc le plus sûr?
hdop?
comment savoir si GPS précis? pdod,hdop,vdop=5.0,2.8,4.4 quand GPS pas précis, peut-on en faire quelque chose pour déterminer précision?
altitude GPS?
utiliser nmeadeviceconfig bPause pour désactiver dynamiquement (par contre pas pour MTi-G à cause des angles...)
dans nmeadevice, ne plus chercher à récupérer tous les nmea sentences en même temps, retourner une erreur seulement s'il n'y en a aucun
add rotation matrix multiplication to enable coordinate system change, convention abcdefgh comme mti
Razor invalid data au début parfois sous linux, jusqu'à 2048 octets invisibles invalides?
MT, SBG specific NMEA messages...
convert AIS to C code...
rajouter OSComputerI2CPort rpi
auto magnetic calbration algo in plane and space, see Matlab code in ptrbrtz, add magnetic declination in AHRS config files (or use yaworientation parameter)?
gps éthernet, logguer cette heure, synchro heure pc avec GPS, prendre plutot gprmc?

Obstacle avoidance
enable/disablegeofence coordinates/file command, in 3D
surfaceobstacleavoidance needs to be debugged (corrupted memory...)...
positionobstacleavoidance : faire tuto ajout step-by-step
wallavoidance, visualobstacleavoidance : it is reactive behavior
wallavoidance : on pourrait contourner l'obstacle par wall following à droite ou à gauche choisi intelligemment
the control part of obstacle avoidance could be centralized to handle all the types of obstacles (punctual, line...), maybe using vector fields
add vector field obstacle avoidance mission like visual obstacle, e.g using AIS and simulatedinternetswarmondevice

configdistancecomputation
distancecomputation
commande waitdistanceless/more/wgs x y d

Altitude sonar, objects detection sonar
faire filtre passe-bas sur le dernier tour sonar, afficher <dmin si résultat trop petit ou >rangescale si oo renvoyé par firstobsdist avec threshold à 5 ou faible
l'ouverture angulaire verticale totale du sonar est de vbeam=40 deg donc h=d*sin(vbeam/2.0)
prévoir aussi mode sécurité altitude (mais peut être intempestif si dans piscine avec sonar) et profondeur->commandes startaltitude/depthprotection
essayer de déterminer un dmin et dmax entre lesquels on peut espérer voir des objets (zone < un certain seuil, avec la médiane)
détecter les objets <= une certaine taille dans cette zone
cas particulier du gate où c'est 2 objets éloignés d'une distance connue, pourrait aider à la localisation
faire un tracking et voir s'ils se confirment

voilier
dans la phase de station, les actionneurs restent à leur dernière valeur, est-ce que c'est le mieux?
si interruption de mission et qu'on reprend, il faudrait faire un forcecheckstragey et forcesailupdate...
setwindestimation : command to set psitwind and vtwind, also add for water current and waves?
kalman pour retrouver vent vrai?
lorsqu'on vire de bord, la girouette va se retrouver à un moment à un angle de 0 et ce sera forcément la direction du vrai vent, par contre pas filtrer passe-bas à cause du retard, filtrer en regardant quand on passe de 5 valeurs positives à 5 valeurs négatives
prendre en compte vitesse gps et estimation de vtwind donnée en paramètre (en option, e.g. si vtwind_med pas mis à 0...)

changer observer (et éventuellement simulator) pour que omegadot=alphaomega*(u1-u2)-alphafomega*omega (au lieu de thetadot=alphaomega*(u1-u2)...)
si on a une IMU, on l'utilise pour omegahat, si on a un GPS, on l'utilise pour la vitesse... (activer ça selon les robid)
vitesse GPS a priori bonne si dispo, par contre vaut mieux pas trop utiliser l'altitude du GPS (uniquement en dernier recours)
utiliser les accéléros quand on a rien d'autre? refaire des tests...
prendre en compte dans la localisation la position GPS de la bouée avec longueur du câble et profondeur du sous-marin?

openal, pingertracking->script python séparé

replay
voir UxVDataViewer
replay with mission planner?
faire option lecture de fichier sonar qui lit les temps et attend de dt=t1-t0 avec t0 et t1 lus dans le fichier, voir comment c'est fait pour vidéo
rajouter fonction replay uxvctrl, comment gérer mieux les histoires de conversions de temps?
il faudrait sans doute faire des cas particuliers car les données sont parfois dans des fichiers séparés (caméra, sonar) et pour le sonar le temps de reconfiguration est variable donc c'est pas facile de manuellement choisir le moment où un fichier particulier doit être relu
mais on peut éditer un peu les fichiers pour que ça colle bien... faire des programmes de concaténation qui remplissent avec des blancs quand il n'y a rien? et s'il y a changement de config, il y a eu appel à sonarconfig (quand il y a eu déconnexion intempestive, on peut concaténer car il n'y a pas de changement de paramètres)
j'ai déja des commandes sonarconfig Seanet.txt, rajouter paramètres loop et delay?
plutôt faire un programme qui regroupe les données de tous les fichiers capteurs (y compris sonar, nmea ou lognav?) en un gros fichier (video pourra être gérée indépendemment ou éclatée en fichiers)
t;type;data
mais il y a aussi des paramètres dans les fichiers de config...
2 approches : un gros fichier qui contient tout ou plusieurs fichiers lus directement par les codes de gestion de périphériques correspondants (le problème est la synchro des temps)
il faut qu'on puisse indiquer qui fixe la base de temps et qui doit se synchro dessus->il faut juste spécifier l'heure absolue de début pour que les différents replay sachent quand prendre des données des fichiers?
paramètre absolutebeginreplaytime dans chaque fichier de config au lieu de delay? (il suffit de lire le nom du fichier en fait...)
dans ce cas il suffirait de faire des sonarconfig log_with_date.csv au début et à chaque reconfig dans un fichier de mission inspiré de l'original, avec le mode spécial replay du sonar qui lit chaque ligne dès que le moment est bon en supposant que la date de début est celle dans le nom de fichier
razor, es (indépendant ou via seanet), ssc sauvegardent données brutes sans indication de temps...
should add variable datacounter for each device?
rajouter device qui lit un fichier csv, qui attend le bon temps et avant de lire les données de chaque ligne (temps absolu ou relatif en option)
ce serait bien aussi de pouvoir charger un fichier qui donne des données en fonction du temps et de la position...

simu
reprendre VSim et le renommer en UxVSim et y rajouter des devices et équations pour d'autres robots, et/ou intégrer les devices simulés et équations de robots dans UxVCtrl?->au moins les équations, il y a déjà des robid prévus pour différents simulateurs...

CISCREA
après un test rapide en rs485 sur le ciscrea dissous, il semble que la période du thread ciscrea ait des pics de 0.095 s, moyenne 0.070
pouvoir afficher period pour tous les threads
reorganisation CISCREA comme autres hardware pour pouvoir prendre en compte paramètres du fichier de config, voir noms/numérotation des moteurs, clockwise
regarder paramètres internes caméra reg 11=0LRUDS01 (LRUDS : boutons OSD) (light adjustement...), programme indépendant commandes bas niveau pour les propulseurs ciscrea, rampe, faire un pwm logiciel pour les faibles vitesses...

attention aux valeurs au départ d'initialisation, attention au setstateestimation...
surveiller divisions par 0..., vérifier cohérence paramètres par défaut
surveiller le abort et abortmission... n'arrive pas toujours à arrêter toutes les régulations?

deadlocks à cause de killthread? il faudrait plutôt utiliser quelque chose comme WaitForUserInput() au lieu de fgets...

robid, robid mask : regrouper sailboat et motorboat ensemble pour laisser de la place pour UGV et UAV?
robid log file?
pour les périphériques, des fois faire une structure correspondant à chaque trame améliorerait la lisibilité...?
image : passer au log pour que les zoom, rotations... deviennent comme des translations...?
gestion vagues et z, courants et vxy, wind...
uxvguiwinforms pour zoom et ancienne gui, rajouter entree de lat0,long0, err, affichage lat long, remoteopencv gui
rmtcommand (client serait juste telnet)
compiler UxVCtrl pour android (ne doit pas appeler opencgui, pas de timers...)
rajouter un device qui communiquerait avec une MOOSDB
connectionqualitychecker: programme server/client qui évalue la qualité de la connexion wifi et déclenche une alarme sonore en cas de problème
procédure équilibrage auto en mesurant vitesse de montée : en fait il faudrait une bonne estimation de rho_water, V_robot et alpha...
peut-être pas trop s'embêter à faire un programme qui fait tout pour récupérer en cas d'erreur, le faire quitter dès qu'il y a une erreur et avoir un autre programme qui surveille sa présence et le relance s'il est arrêté. Il faut que le programme soit ensuite capable de reprendre là où il en était



OLD

check \n in commands for Linux...->ne marche pas
bug : procedure 1 already exists quand elle est déclarée à la fin et qu'on a déjà du la chercher, sans doute pareil pour labels...->vérifier aussi si la ligne enregistrée est différente...
tester aussi ce qu'il se passe si redéfinition...
check correct jump/goto/execute/return lines w.r.t. ftellline()...

bug : toujours pas de snapshot pour ASV (periode des snapshots trop grande?)...->mettre pic_counter = 1000 quand on détecte pas
remove the msg_..._msg in mavlinkdevice
need command procedure procedure.txt to be able to go back to previous point in the mission...

Bug maestro rpiz et rpi2, déconnexions intempestives, compiler en debug pour comprendre, timings? Test with micro maestro?->changer hub usb, certains types semblent provoquer une incompatibilité...

dessiner en cyan les distances sonar?->pas très visible si caméra activée...

Pb compil linux ais

pour mieux gérer les problèmes de EOL, au moment où on fait isdigit() ignorer les CR, LF...->use %[^\r\n]255s like in Video in all devices?->only good when we expect to get spaces in the string...

commande checkXXX bTrue bNbCommandsToSkip pour faire un peu comme un if et goto
checkball 0 2
sendmsg
track
checkball 1 4
balldetection
checkball 0 2
sendmsg
track
continuewall

up/down/left/rightlimit en px pour les parties de robots visibles à l'écran lors des traitements (ou mieux, definir une forme plus complexe un peu comme la map dans env)
Add cropping for each cam to handle zed correctly, -1 is no cropping->hscale and vscale partially gives similar functionality (translation missing)
hcenter,vcenter,hshift,vshift to translate before and after rotation? check logvid2imgoverlay

Need to improve command line only mode to display switch, gps fix... info in extra info->not really necessary, see log file

temps de convergence au départ pour localisation gps et peut-être sonar quand on RAZ?->c'est sans doute normal, lié au fait qu'on sait qu'on bouge pas (si vxyhat n'est pas de largeur infinie)...
affichage sonar déjà assez optimisé contrairement à ce que je pensais?
trouver comment dessiner plus efficacement l'image sonar (sans superposition de dessin, quel que soit zoom...)->déjà pas mal?

update additional parameter in ballconfig in samples...
si bBalldetection ou bBalltracking arrêté alors qu'il y a eu une ball détectée, il continue à envoyer des msg acoustiques jusqu'à ce qu'une autre commande acoustique remplace

problème reconnection GPS Galaxy S? c'est peut-être juste qu'il capte pas bien...->à cause de l'Ubiquiti!

j'ai oublié de mettre les stopvideorecording? mais en fait ils risquent de ne pas vraiment être appelés...

ardupilot mavlink : gps fix clignote car il y a des trames qui sont pas du GPS par moment (le GPS n'envoie des trames que toutes les 0.5 s)...->utiliser un chrono

controle à distance des touches par wifi pas top (interruptions...)
decrease opencvgui period for better effect on keys trex? RDP UDP causes key pressed loss? repeat key windows param?

synchro temps des chronos et gettimeofday, utc...->mettre données brutes en gettimeofday, missions en chrono...
dans logstate rajouter tv_sec;tv_usec; pour pouvoir synchroniser temps tasks et raw data

sauvegarder toutes les données presque brutes px4flow pour postprocessing (flow, flow_rad...), angles ardupilot aussi (attitude mid 30, gps, altitude...)?
mais on dirait que je reçois pas optical_flow_rad... changer de firmware?

0 bizarres dans depth des logmission du harbor alors que pas de problèmes dans les données brutes pression...
il y a des 0 qui s'affichent parfois brièvement pour depth dans opencvgui sur le nuc?
zhat à 0 aussi dans logstate, mais rien vu dans pressure... attention, il y avait du z_mes pris par GPS?

bGPSOKNMEADevice pour nmea, bGPSOKMT pour mt, bGPSOKMAVLinkDevice[0], bGPSOKMAVLinkDevice[1] pour mavlink et bGPSOKSimulator pour simu...
commandes enableautogpslocalization/disableautogpslocalization (dans observer?)

observer : prévoir d'autres equations quand gps non dispo (voir etas_wheel eurathlon 2013 pour robot terrestre), comment déterminer si GPS OK...

synchro gui etas_wheel à faire (touches et affichage pour u_max, uw_max...), synchro périph faite
buggy, trex... : afficher aussi u_max

replaceinfile enable disable kinect or new config (e.g. Release_compat), also for ciscrea, labjack, because of their dependencies (add new defines, check .gitignore...)

maestro : add param to tell which version (micro maestro does not support set multiple targets...)
servo voile tout le temps remis à jour? ajouter option pour choisir si on utilise la commande multiple targets?

maintenant il n'y a plus besoin de lire ch9 et 10, ch gouvernail et voile échangés pour meilleure compatibilité avec autres robots

afficher position des waypoints dans l'interface->en fait je peux un peu les tracer via le fichier env.txt, mais ce serait mieux si c'était automatique (en option avec touche...), le plus simple est d'afficher le waypoint courant ou la ligne courante...

maestro : 115200, délai 15 ms entre write et read, mauvaise gestion des timeouts du 1er byte reçu (en debug j'ai vu que les 2 bytes finissaient bien par arriver...), mauvaise interprétation de Bytes==0...?->le timeout semble bien avoir lieu (mesuré avec chrono), tentative aussi avec flags FILE_FLAG_WRITE_THROUGH|FILE_FLAG_NO_BUFFERING mais c'est pas mieux, voire pire..., et avec un baudrate plus élevé il y a peut-être moins de problèmes, mais c'est pas clair...->délai 15 ms entre write et read semble résoudre le problème...

wpfollowingfileconfig radius file bWGS
linefollowingfileconfig radius gamma_infinite file bWGS
startlinefollowingfile
stoplinefollowingfile
startwpfollowingfile
stopwpfollowingfile

waypoints.csv avec colonnes optionnelles, radius, durée de station, durée de surface, bUseGPS, profondeur, gamma_infinite

affichage tous les counter==

un fichier de config pour décrire les périphériques du robot?->c'est déjà un peu ce que fait UxVCtrl.txt

touches z, s : ouvrir/fermer voile
le fait qu'il revienne droit quand on va en marche av ou ar convient pas pour buggy, prévoir une touche pour activer/désactiver?->fait automatiquement selon robid

rajouter heure, min, s avant auxbuf dans log sonar (voir leur calcul pour chaque ping...)

gcc -fpermissive
destroywindow dans code théo->bCleanUp

sonarstaticlocdevice : merge à faire... a beaucoup servi pour débugger sonar au début, maintenant qu'est-ce qu'il a de plus?
gui->sonarstaticlocstructured
sonar device handling->uxvctrl, sonartest, sonardisptest
localisation->sonarstaticlocstructuredsimu

restaurer régulations et u après brake?-> mais le but du brake est de s'arrêter...
dans bBallTrackingControl sauvegarder images et pouvoir juste faire un brake
brake en option pour surfaceavoid?

seanet : faire version de GetLatestMsgSeanet et GetMsgSeanet qui ne prennent pas en paramètre le mid mais retourne celui trouvé (pour pouvoir gérer les messages de l'echosondeur via le sonar)

rubber boat : no sonar echo? c'est plutôt une ombre

pour la ball en coop, il ne faut pas que les 2 robots utilisent leur sonar en même temps! l'investigator aurait droit à bouée GPS et Wi-Fi?

visual obstacle paramètres pour autre algo ou nouvelles commandes? -> mieux vaut une nouvelle commande, il y a déjà assez de paramètres comme ça...

#YPR=-71.64,21.12,-125.02 repère des marins avec 180/-180 au sud, nord vers connecteur ftdi

prise en compte lat long mti-g si lat long différent de 0, support de bGPSOK...

discontinuité hsl... singularité rouge : utiliser si hmin<hmax ou hmin>hmax pour gérer discontinuité->fait en dur...

les vidéos ne sont pas lues à la bonne vitesse (mais on peut jouer sur captureperiod)

CreateTimer(&timer, VideoRecordCallbackFunction, (void*)videoid, 1, captureperiod)->CreateTimer(&timer, VideoRecordCallbackFunction, (void*)videoid, captureperiod, captureperiod)?

faire dossiers log, pic, vid, aud
plante lorsque 2 fichiers vidéos sont ouverts?->résolu en rajoutant délai pour les 1ers cvqueryframe?
dummy video (black) to be able to have gui when no camera

pourquoi il avance? bug arrêt du wall tracking marche pas?->bug strncmp : stopxxx interprété par stop

pourquoi en tracking tout devient vert->seuil à 0 parce que non géré

log mti sans yaw? la configurer pour qu'elle envoie toujours euler, les accélérations et vitesses de rotation... ou faire en sorte que le code le fasse à chaque fois si pas possible pour vieille mti... le vieux mt software la déconfigure au lancement, utiliser plutôt mt manager...

certaines portées du sonar ne seraient pas acceptées? a priori c'est juste seanet qui accepte pas...

keys
O orig GPS
G pos GPS
Z raz xy
S pos sonar+-5,5 toujours...

obstacle avoidance : uw=1 si obstacle à droite, -1 si à gauche, aléatoire si en face
staticsonarloc ne semble plus avoir le droit de contracter dès qu'il a réussi à contracter
$ dans l'aide, rajouter touche pour activer/désactiver osd mission courante
ajout de utc dans mti : vérifier codage big/little endian...
en dessous de thrust 0.5 en normal on n'avance pas...

enregistrer aussi des images/vidéos avec les détections dessus tous les un certain temps, idem données sonar et wall following...

il y a plein de 0 dans les données brutes gps loggées, sans doute parce qu'on s'est mis en mode wb...-> en fait je loggue pas les bonnes trames? ou alors il n'avait pas souvent le fix?->bug

pouvoir synchro utc et temps ordinateur avec nmea : mais a priori la précision sera d'une s de toutes façons...

revoir le log de la mti en prenant exemple sur les données prises avec mti-g

modifier config ssc32 : voir servo.txt, la vérification des limites spécifiées sera faite à la config
prendre en compte le fait que les PWM peuvent aller de 500 à 2500 pour aller plus loin avec certains servos
faut que changement supérieur à certain seuil pour qu'on change l'actionneur pour éviter les tremblements (rudder, sail...)
rajouter SetPWMsSSC32 qui fait plusieurs channel

prévoir une commande spéciale comme setstateestimation/gpslocalization qui attende la réponse par acoustique (x,xerr,y,yerr,t,terr..., il y aurait demande de la position de l'autre modem et commande rng...)
toutes les 5-10 s le robot de surface envoie xyzerr (4 int16) et en réponse le sous-marin répond rng (la correction d'erreur se fera par envoi de plusieurs)

utilité du bError dans CISCREAThread, on risque de mettre à jour des données invalides... je voulais vérifier alarm, bExit...

il tourne très vite quand il avance pas, par contre quand il avance à fond il tourne peu : à cause du boost!
en fait en boost il a vraiment du mal à tourner comme on veut par rapport à l'arrêt...
pour qu'il puisse avancer tout en tournant un peu, il faudra sans doute qu'il ait une vitesse minimale sinon ça fera n'importe quoi...

couleurs texte gui, le vert c'est nul dans l'eau!!

l'estimation de omegahat est très imprécise, voir pourquoi, tester avec vrai robot...? estimer par simu avec les entrées ou filtre passe bas...
comment évaluer correctement la vitesse connaissant la position (par simu avec les entrées ou filtre passe bas...)
le filtre passe-bas va sans doute retourner des vitesses très faibles, il vaut mieux encore estimer à partir des entrées...

ciscrea tourne d'1 tr/s au moins

les ordreX sont bizarres...

ajouter partie calibration magnétique pour boussole interne CISCREA, rajouter signe (pour une boussole simple, le signe a du sens, pas vraiment pour une IMU...) et enlever roll et pitch par rapport à MT car c'est une simple boussole

vitesse de la boucle du thread ciscrea? où mettre les sleep? temps d'attentes entre les requêtes modbus en cas d'échec? tester rtu et tcp
ne pas faire plus de 60 requêtes/s environ? attention à ne pas bloquer aussi les autres threads avec les sections critiques pendant les requêtes modbus...
2 requetes modbus avec des mSleep(10) (sous Windows mSleep() doit durer au moins 15 ms en réalité) entre chaque donne une période de thread d'un peu plus de 60 ms en RS485, un peu moins en TCP
=> 1 requete modbus pour plusieurs registres d'un coup semble durer environ 10-15 ms
si on met pas de mSleep entre les requêtes, il y a des Modbus retry, et ils durent en fonction des réglages de timeout modbus (en RS485, il semble que les timeouts soient *2, en TCP c'est comme réglé)

démarrage rov avec trame de 1000 caractères (250 ms de com) nécessaire? le robot redémarre en boucle tout seul dès que le boitier est branché? Semble OK (en RS485 uniquement), bien envoyer une trame suffisamment longue/communiquer suffisamment longtemps...

modbus tcp does not support req of more than 128 bytes? possible...

rajouter proportionnellement à u_max, uw_max, uv_max quand on reste appuyé sur une touche?
tester régulation boost mode avec vrai robot, c'est peut-être bien d'avoir un mode mi-vitesse et mode full (mode normal/mode rapide ou même mettre un coefficient réglable, séparer ce coef pour propulseurs horizontaux et verticaux) car le mode mi-vitesse pratique pour manoeuvres manuelles => u_coef, uw_coef

pour les suivis de waypoints ou ligne, il faut des commandes qui prennent x,y et d'autres lat long (wgs)
mettre valeurs par défaut pour gamma_infinite, r (r sera commun à wp et line) dans uxvctrl.txt
plus besoin du r dans gotoxyrt
cancelgotoxy?-> le stop fait déjà ça...
log avec unix time, lat, long, depth (pour unixtime, on va faire juste avec t vu que de toute façon on n'a pas l'heure exacte...)
faire variable depth, compass de la même façon que latitude et longitude pour ces unités classiques? pas forcément utile, risque de rajouter de la confusion?
rajouter angle_env = M_PI/2.0-d0*M_PI/180.0; à setenvcoordposition
gpslocalization t qui bloque jusqu'à ce qu'il ait le fix ou le timeout, en général il vaudra mieux entre sûr d'être en surface depuis longtemps pour améliorer la précision
bGPSOK? pour simulator, le GPS fait des mesures quand z >= z_gps_lim
distinction gpssurface, gpssubmarine, faire 2 commandes distinctes? plutôt gérer qu'un seul gps, la plupart du temps on n'en a qu'un, et on augmente l'erreur si sur bouée pour l'instant, si on rajoute le cas particulier bouée il faudra prendre en compte longueur du câble et profondeur pour que ça ait vraiment un intérêt de faire la distinction...

régulation en profondeur peut-être un peu imprécise et use les propulseurs, peut-être faire une commande plus progressive -> mais risque de faire que le sous-marin se stabilise avec le propulseur qui tourne tout le temps

organisation include config.h dans hardware (voir sonar...)

visualobstacleavoidance/wallavoidance
en fait le wall tracking est un line following avec une distance d0 au lieu de 0, généraliser line following avec d0 (voir sonar...)

thrustboost marche pas à cause de u1u2u3 mis à jour tout le temps, en fait il n'a pas de sens si on fait une régulation avec boost en ne diminuant qu'un propulseur pour tourner
mettre le nouveau type de régulation en cap : en fait c'est surtout l'estimation de omegahat avec sin qui est intéressante dedans

bitmask pour les robid, simulateurs bit 1
pb mti donnée aberrante constante de temps en temps?-0.261799=>-15 deg sans corrections mag et dans env_La_Spezia (345)=>yaw à 0 -> need more accurate buflen as input of findmtmessage, checking the checksum is not enough reliable!
set MTi to EULER mode with software

nmea device et faut qu'il puisse y avoir plusieurs nmeadevice différents sur un robot

bug si 2 caméras configurées mais en fait 1 présente, bug arrêt du programme à cause de terminate thread?

ajouter en coin et agrandi si touche 'm' la map avec option robot centré avec rotating map
maintenant tout est exprimé in env coordinate system, on utilise EnvAngle quand il y a un calcul avec boussole, GPS...
repères ENU, env, submarine...
enlever les videoid_ball du fichier de config...
bug lorsque la résolution de la video effective n'est pas celle voulue
p fait abort command si pas de mission
balldetection 30 1 tapé dans l'invite de commandes semble infini...
paramètre uvmax pour la régul profondeur pour économiser bat
arreter de tourner en avancant lorsqu'on est avec les touches sans regulation
option disable video display dans opencvgui dans fichier de config et opencvgui
fmod_2pi à la place du sin(asin())
thread ciscrea bloquant quand echec connexion, missing lots of err check...
bDistanceControl, u_ball = u pour cruisespeed
mettre en option la caméra de opencvgui, ou un opencvgui pour chaque cam?
regrouper log observer et controller en un même fichier
touche pour call/abort mission.txt avec petit triangle vert clignotant
en fait je suis dans repère nwu, changer les angles pas marins en enu
estimation de omegahat
fgets3, fscanf, sscanf?
command prompt en option
pouvoir lire une video en option
des = 0 supprimés en bloc dans globals.h
remettre à 0 integral si changement de consigne, revoir où on le remet à 0...
doit afficher osd meme sans video
osd:heading/regul(marin), depth/regul, x(+/-err), y(+/-err), 
projet comet et MissionTest à regouper

un thread pour la prise de données de chaque périphérique, l'accès aux données par var globales (globals.h) doit être immédiat
un thread de fichier log general?
un timer pour enregistrement vidéo
un timer pour enregistrement audio
un thread pour chaque traitement long
un thread boucle de régulations de base
un thread lecture-interpréteur fichier de mission, entrées clavier (Commands.h)
un thread GUI
un thread simulateur
